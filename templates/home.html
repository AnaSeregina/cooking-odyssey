{% extends "base.html" %}
{% load static %}
{% load static imagefmt %}
{% block title %}Welcome to the Cooking Odyssey{% endblock %}
{% block content %}
  <div class="recipe_collection_grid">
    {% for r in recipes %}
      <div class="recipe_card">
        <h3><a href="{% url 'recipe_detail' slug=r.slug %}">{{ r.title }}</a></h3>

        <a class="recipe_image_wrapper" href="{% url 'recipe_detail' slug=r.slug %}">
          {% if r.hero_image and r.hero_image.name %}
            {% with base=r.hero_image.url|remove_ext %}
              <picture>
                <source srcset="{{ base }}.avif" type="image/avif">
                <source srcset="{{ base }}.webp" type="image/webp">
                <!-- Fallback to the original format (jpg/png/etc.) -->
                <img
                  src="{{ r.hero_image.url }}"
                  alt="{{ r.title }}"
                  loading="lazy"
                  decoding="async"
                  width="600" height="400"
                >
              </picture>
            {% endwith %}
          {% else %}
            <picture>
              <source srcset="{% static 'img/no_image_yet.avif' %}" type="image/avif">
              <source srcset="{% static 'img/no_image_yet.webp' %}" type="image/webp">
              <!-- Keep your existing PNG as the guaranteed fallback -->
              <img
                src="{% static 'img/no_image_yet.png' %}"
                alt="{{ r.title }}"
                class="placeholder-img"
                loading="lazy"
                decoding="async"
                width="600" height="400"
              >
            </picture>
          {% endif %}
        </a>
       
        {% if r.description %}
          <div class="card_footer">{{ r.description }}</div>
        {% endif %}
      </div>
    {% empty %}
      <p>No recipes yet. Add some in <a href="/admin/">Admin</a>.</p>
    {% endfor %}
  </div>
{% endblock %}